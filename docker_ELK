sudo yum -y install open-vm-tools nano git wget gcc
sudo yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
sudo subscription-manager repos --enable "rhel-*-optional-rpms" --enable "rhel-*-extras-rpms"

cd /usr/src
wget https://www.python.org/ftp/python/3.7.0/Python-3.7.0.tgz
gunzip Python-3.7.0.tgz && tar -xvf Python-3.7.0.tar
cd Python-3.7.0
./configure -prefix=/usr/local/
sudo make altinstall
sudo ln -s /usr/local/bin/python3.7 /usr/bin/python3
sudo ln -s /usr/local/bin/python3.7 /usr/local/bin/python3

curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
python get-pip.py

#sudo yum -y install python37
#sudo yum -y install python-pip

sudo sed -i 's/# include/include/' /etc/nanorc
sudo sed -i "\$aset const" /etc/nanorc

sudo firewall-cmd --permanent --add-port=9200/tcp
sudo firewall-cmd --permanent --add-port=9300/tcp
sudo firewall-cmd --permanent --add-port=5000/tcp
sudo firewall-cmd --permanent --add-port=5601/tcp

sudo wget https://download.docker.com/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker.repo
sudo yum -y install docker-ce

sudo systemctl start docker
sudo systemctl enable docker

sudo curl -L "https://github.com/docker/compose/releases/download/1.22.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

cd /usr/share
sudo git clone https://github.com/elastic/stack-docker.git
cd stack-docker

sudo sed -i 's/6.3.0/6.4.1/' .env
sudo sed -i "\$aPWD=/usr/share/stack-docker" .env
sudo sed -i 's/1.21.2/1.22.0/' setup.yml

make

sudo /usr/local/bin/docker-compose -f setup.yml up
